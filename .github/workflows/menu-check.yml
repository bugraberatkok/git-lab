name: ğŸ¤– Menu Validation

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  validate-menu:
    runs-on: ubuntu-latest
    name: Check Menu Quality

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: â˜• Set up Java 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: ğŸ”¨ Compile Java files
        run: |
          echo "Compiling menu system..."
          javac src/*.java
          echo "âœ… Compilation successful!"

      - name: ğŸš« Check for sold out items
        run: |
          echo "Checking menu availability..."
          if grep -r "SOLD OUT" src/; then
            echo "âŒ Error: Found SOLD OUT items in the menu!"
            echo ""
            echo "The cafeteria menu should not contain sold out items."
            echo "Please remove 'SOLD OUT' from any menu items before merging."
            echo ""
            echo "Hint: Check your DailySpecials.java file!"
            exit 1
          fi
          echo "âœ… All menu items are available!"

      - name: ğŸ’µ Validate price format
        run: |
          echo "Checking price formatting..."

          # Check if prices follow the $X.XX format
          for file in src/Food.java src/Drinks.java src/DailySpecials.java; do
            if [ -f "$file" ]; then
              # Look for lines with println that don't have proper price format
              if grep -E 'println.*[^$][0-9]' "$file" | grep -v '\$[0-9]+\.[0-9]{2}' > /dev/null 2>&1; then
                echo "âš ï¸  Warning: Some prices in $file might not be formatted correctly"
                echo "   Expected format: $X.XX (e.g., $9.99)"
              fi
            fi
          done

          echo "âœ… Price check complete!"

      - name: ğŸ‰ Success message
        if: success()
        run: |
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚  ğŸ‰ All checks passed!          â”‚"
          echo "â”‚  Your menu looks great!         â”‚"
          echo "â”‚  Ready for review by teammates  â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"